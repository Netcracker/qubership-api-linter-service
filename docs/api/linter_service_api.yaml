openapi: 3.0.3
info:
  title: Linter Service API
  version: "1.0"
  description: The Linter Service API provides a set of operations for validating (linting) the quality of OpenAPI specifications. It enables the management of rulesets used for validation, as well as the validation process itself.
servers:
  - url: /
security:
  - BearerAuth: []
  - api-key: []
  - PersonalAccessToken: []
tags:
  - name: Ruleset Management
    description: API related to management of validation rulesets.
  - name: Validation Result
    description: API for retrieving Spectral validation results for package versions.
paths:
  /api/v1/rulesets:
    get:
      tags:
        - Ruleset Management
      summary: Get a list of rulesets.
      description: >
        Returns a sorted list of rulesets.  
          The sorting follows a strict order:
            1. The currently active ruleset (always appears first).
            2. Rulesets that have never been activated (in order of creation).
            3. All other rulesets, sorted by the latest activation date (most recent first).

        There is always one active ruleset in the system.
        This operation is available only to users with the `system administrator` role.
      operationId: getRulesets
      parameters:
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
            minimum: 1
          example: 1
        - name: limit
          in: query
          description: Number of items per page (max 100).
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 100
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: array
                minItems: 1
                items:
                  $ref: "#/components/schemas/Ruleset"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    post:
      tags:
        - Ruleset Management
      summary: Create a new ruleset
      description: >
        Allows an admin to create a new ruleset by uploading a YAML file.
        The new ruleset is set to 'Inactive' by default.
        This operation is available only to users with the `system administrator` role.
      operationId: postRuleset
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/RulesetCreate"
      responses:
        "201":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ruleset"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/v1/rulesets/{id}:
    get:
      tags:
        - Validation Result
      summary: Get ruleset metadata
      description: >
        Returns the ruleset name, status, and activation history.
        This operation requires read permission.
      operationId: getRulesetById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Unique ruleset ID
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ruleset"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags:
        - Ruleset Management
      summary: Delete a ruleset
      description: >
        Delete a ruleset.
        Ruleset can be deleted if it is in inactive status and no version validated against this ruleset exist.
        This operation is available only to users with the `system administrator` role.
      operationId: deleteRuleset
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Unique ruleset identifier
      responses:
        "204":
          description: Success
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/v1/rulesets/{id}/activate:
    post:
      tags:
        - Ruleset Management
      summary: Activate a ruleset
      description: >
        Activate an inactive ruleset. Currently active ruleset is automatically deactivated after new ruleset is activated.
        This operation is available only to users with the `system administrator` role.
      operationId: postRulesetsActivate
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Unique ruleset ID.
      responses:
        "204":
          description: Success
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/v1/rulesets/{id}/download:
    get:
      tags:
        - Ruleset Management
      summary: Download Spectral ruleset file
      description: >
        Returns the plain YAML content of the ruleset.
      security: []
      operationId: getRulesetDownload
      parameters:
        - name: id
          in: path
          description: Unique ruleset ID
          required: true
          schema:
            type: string
        - name: disposition
          in: query
          description: >
            Controls the content disposition of the response.
            Use `inline` to display in browser, or `attachment` to trigger download locally.
          schema:
            type: string
            enum:
              - inline
              - attachment
            default: inline
      responses:
        "200":
          description: Success
          content:
            application/yaml:
              schema:
                type: string
                description: YAML content of Spectral ruleset file.
          headers:
            Content-Disposition:
              schema:
                type: string
                description: Header is required if inlineContent = false. When present, must have "attachment" and "fileName" parameters.
                example: attachment; filename="<original file name>.yaml"
            X-Content-Type-Options:
              schema:
                type: string
                enum: [nosniff]
                example: nosniff
                description: Prevents MIME-type sniffing.
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/v1/packages/{packageId}/versions/{version}/validation/summary:
    get:
      tags:
        - Validation Result
      summary: Get validation summary for a package version
      description: >
        Returns a summary of the validation status for the specified package version,
        including the ruleset used and issue counts grouped by severity.
      operationId: getPackageVersionValidationSummary
      parameters:
        - name: packageId
          in: path
          required: true
          schema:
            type: string
        - name: version
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: array
                minItems: 1
                items:
                  $ref: "#/components/schemas/ValidationSummary"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/v1/packages/{packageId}/versions/{version}/validation/documents:
    get:
      tags:
        - Validation Result
      summary: Get validated documents for a package version
      description: >
        Retrieves the list of documents that were validated within the specified package version,
        providing basic metadata like document ID, title and specification type.
      operationId: getPackageVersionValidationDocuments
      parameters:
        - name: packageId
          in: path
          required: true
          schema:
            type: string
        - name: version
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ValidatedDocument"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/v1/packages/{packageId}/versions/{version}/validation/documents/{documentId}/details:
    get:
      tags:
        - Validation Result
      summary: Get validation details for a specific document under a given ruleset
      description: >
        Returns detailed validation results for a specific document within the package version, including the list of issues, severity levels,
        line numbers for a specific document within the package version.

        Sorting of validation issues:
        1. By severity: "error" -> "warning" -> "info".
        2. Within the same severity by document position from start to end.
      operationId: getPackageVersionValidationDocumentsDetails
      parameters:
        - name: packageId
          in: path
          required: true
          schema:
            type: string
        - name: version
          in: path
          required: true
          schema:
            type: string
        - name: documentId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationDetails"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
components:
  schemas:
    ErrorResponse:
      description: An error description
      type: object
      required:
        - status
        - code
        - message
      properties:
        status:
          description: HTTP Status Code
          type: integer
        code:
          description: Internal string error code. Mandatory in response.
          type: string
        message:
          description: The attribute contains an error message.
          type: string
        params:
          type: object
          description: Optional message parameters
        debug:
          description: Debug details
          type: string
    Ruleset:
      description: Ruleset's parameters
      type: object
      required:
        - id
        - name
        - status
        - createdAt
        - canBeDeleted
      properties:
        id:
          type: string
          description: Unique identifier of the ruleset.
        name:
          type: string
          description: Unique name of the ruleset.
          example: "OpenAPI Quality Ruleset"
        status:
          description: Status of the ruleset.
          type: string
          enum:
            - active
            - inactive
        activationHistory:
          description: |
            Information about periods when ruleset was activated/deactivated. 
            If empty, means that ruleset was never activated.
            Important: Only the latest 100 activation records are returned.
          type: array
          items:
            type: object
            properties:
              activeFrom:
                description: Date when ruleset was activated.
                type: string
                format: date-time
              activeTo:
                description: Date when ruleset was deactivated.
                type: string
                format: date-time
        createdAt:
          description: Date of ruleset creation.
          type: string
          format: date-time
        canBeDeleted:
          description: |
            Indicates whether the ruleset can be deleted:
              - canBeDeleted = true - if both of the following conditins are met:
                  - ruleset is in inactive status
                  - there is no existing version revision that was validated against current ruleset.
          type: boolean
          example: true
    RulesetCreate:
      type: object
      required:
        - rulesetName
        - rulesetFile
      properties:
        rulesetName:
          description: Unique name of the ruleset.
          type: string
          example: "New Ruleset"
        rulesetFile:
          description: YAML file with Spectral rules.
          type: string
          format: binary
    ValidationSummary:
      type: object
      required:
        - apiType
        - ruleset
        - status
        - issuesSummary
      properties:
        apiType:
          description: Type of the API.
          type: string
          enum:
            - rest
        ruleset:
          description: Information about the ruleset used for validation.
          type: object
          nullable: true
          properties:
            id:
              description: Unique identifier of the ruleset.
              type: string
            name:
              description: Name of the ruleset.
              type: string
            status:
              description: Current status of the ruleset.
              type: string
              enum:
                - active
                - inactive
        status:
          description: Current validation status for the package version.
          type: string
          enum:
            - success
            - inProgress
            - notValidated
        issuesSummary:
          description: Summary of validation issues grouped by severity.
          type: object
          properties:
            error:
              description: Total number of errors.
              type: integer
            warning:
              description: Total number of warnings.
              type: integer
            info:
              description: Total number of informational messages.
              type: integer
    ValidatedDocument:
      description: Metadata about the validated document.
      type: object
      required:
        - documentId
        - specificationType
        - title
      properties:
        documentId:
          description: Unique identifier of the document.
          type: string
        specificationType:
          description: Type of the specification notation.
          type: string
          enum:
            - openapi-3-1
            - openapi-3-0
            - openapi-2-0
        title:
          description: Title of the document.
          type: string
    ValidationDetails:
      description: Validation details for one document under one ruleset.
      type: object
      required:
        - validatedBy
        - issues
        - document
      properties:
        validatedBy:
          description: Metadata about the ruleset that validated the document.
          type: object
          properties:
            rulesetId:
              description: Unique identifier of the ruleset.
              type: string
            rulesetName:
              description: Name of the ruleset.
              type: string
            status:
              description: Status of the ruleset during validation.
              type: string
              enum:
                - active
                - inactive
        issues:
          description: List of individual validation issues in the document.
          type: array
          items:
            type: object
            required:
              - jsonPath
              - severity
              - message
            properties:
              jsonPath:
                description: >
                  JSONPath expression pointing to the location of the issue in the document,
                  conforming to the syntax defined in IETF RFC 9535:
                  https://datatracker.ietf.org/doc/html/rfc9535
                type: string
              severity:
                description: Severity level of the issue.
                type: string
                enum:
                  - error
                  - warning
                  - info
              message:
                description: Description of the validation issue.
                type: string
        document:
          $ref: "#/components/schemas/ValidatedDocument"
  securitySchemes:
    BearerAuth:
      type: http
      description: Bearer token authentication. Default security scheme for API usage.
      scheme: bearer
      bearerFormat: JWT
    api-key:
      type: apiKey
      description: Api-key authentication.
      name: api-key
      in: header
    PersonalAccessToken:
      type: apiKey
      description: Authentication by personal access token.
      name: X-Personal-Access-Token
      in: header
